<!DOCTYPE html>
<html>
  <head>
    <script>
      window.addEventListener("DOMContentLoaded", function () {
        var currentURL = window.location.href;

        if (currentURL.includes("access_token")) {
          console.log("URL hiện tại chứa chuỗi 'access_token'.");
          var startIndex =
            currentURL.indexOf("access_token=") + "access_token=".length;
          var endIndex = currentURL.indexOf("&scope");
          var accessToken = currentURL.substring(startIndex, endIndex);
          var avatarUrl;
          fetch("https://api.twitch.tv/helix/users", {
            headers: {
              Authorization: "Bearer " + accessToken,
              "Client-ID": "qdt8a9lzfgfswr1485wn9y1d9m06bc",
            },
          })
            .then((response) => response.json())
            .then((data) => {
              // Lấy URL avatar từ kết quả trả về
              avatarUrl = data.data[0].profile_image_url;
              console.log("URL avatar Twitch:", avatarUrl);
              window.opener.postMessage(
                accessToken + "," + avatarUrl + "," + "(twitch)",
                "*"
              );
              window.close();
              // Sử dụng URL avatar ở đây hoặc thực hiện các thao tác khác với nó
            })
            .catch((error) => {
              console.error(
                "Lỗi khi lấy thông tin người dùng từ Twitch:",
                error
              );
            });
        } else {
          console.log("URL hiện tại không chứa chuỗi 'access_token'.");
        }
      });
    </script>
  </head>
  <body></body>
</html>
