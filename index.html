<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="text/javascript">
    var _iub = _iub || [];
    _iub.csConfiguration = {"askConsentAtCookiePolicyUpdate":false,"enableLgpd":false,"enableUspr":false,"floatingPreferencesButtonDisplay":"bottom-right","lang":"en","perPurposeConsent":true,"siteId":3253051,"usprApplies":true,"whitelabel":false,"cookiePolicyId":53491756, "banner":{ "acceptButtonDisplay":true,"closeButtonDisplay":false,"customizeButtonDisplay":true,"explicitWithdrawal":true,"listPurposes":true,"position":"float-bottom-center","rejectButtonDisplay":true,"showPurposesToggles":true }};
    </script>
    <script type="text/javascript" src="https://cs.iubenda.com/autoblocking/3253051.js"></script>
    <script type="text/javascript" src="//cdn.iubenda.com/cs/gpp/stub.js"></script>
    <script type="text/javascript" src="//cdn.iubenda.com/cs/iubenda_cs.js" charset="UTF-8" async></script>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>AGAR SOLO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="agar solo is a multiplayer action game where players try to eat other players and grow their own cells. Play for free now!">
    <meta name="keywords" content="agar solo, thecolors, thecolors agar, agar color, agar, action, game, cells, free">
    <meta name="author" content="Agar solo Team">
    <link rel="icon" href="TemplateData/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="https://download.playfab.com/PlayFabClientApi.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" onload="initClient()" defer></script>
  </head>
  <body>
    
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
      <div id="unity-warning"> </div>
      <div id="unity-footer">
        <div id="unity-fullscreen-button"></div>
      </div>
    </div>
    <script>
  
        function uploadImageFromUser(loai) {
          loai = UTF8ToString(loai);
          if(loai == "upload"){
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = '.jpg,.png';
  fileInput.style.display = 'none';

  fileInput.onchange = function(event) {
    instance.SendMessage("logged","loaduploadIMG");
    const file = event.target.files[0];

    const formData = new FormData();
    formData.append('file', file);

    axios.post('https://api.cloudinary.com/v1_1/dv0dagszd/image/upload', formData, {
      headers: {
        'Content-Type': 'multipart/form-data'
      },
      params: {
        upload_preset: 'ml_default' 
      },
      crossdomain: true, 
    })
    .then(function(response) {
      const imageUrl = response.data.secure_url;
      console.log("Image uploaded to " + imageUrl);
      instance.SendMessage("logged","getFilePath",imageUrl.toString());
    })
    .catch(function(error) {
      alert("The selected file has an incorrect format. Only .png, .jpg, and .jpeg formats are allowed");
      instance.SendMessage("Main Camera","tatuser");
    });
  };

  fileInput.click();
}
else{
  const imgUrl = loai;
    const formData = new FormData();
    formData.append('file', imgUrl);

    axios.post('https://api.cloudinary.com/v1_1/dv0dagszd/image/upload', formData, {
      headers: {
        'Content-Type': 'multipart/form-data'
      },
      params: {
        upload_preset: 'ml_default' 
      },
      crossdomain: true, 
    })
    .then(function(response) {
      const imageUrl = response.data.secure_url;
      instance.SendMessage("logged","vanlaload",imageUrl.toString());
      console.log("Image uploaded to " + imageUrl);
    })
    .catch(function(error) {
      console.error('Upload failed:', error);
    });

}
}



      var embeddedPopup;
         function openEmbeddedPopup() {
            var url = "https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=qdt8a9lzfgfswr1485wn9y1d9m06bc&redirect_uri=https://thecolors.id.vn/login.html&scope=channel%3Amanage%3Apolls+channel%3Aread%3Apolls+user%3Aread%3Aemail"
            var width = 600;
            var height = 600;
            var left = (screen.width - width) / 2;
            var top = (screen.height - height) / 2;

             embeddedPopup = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top);
        
            
        }
        
        var poplinked;
        const urltwitter = new URL('https://twitter.nguyenchibinh113.workers.dev');
        function openbitbucketLoginPopup(dame) {
          dame = UTF8ToString(dame);
          if(dame == "discord"){
          var url = "https://discord.com/api/oauth2/authorize?client_id=1141729765145989192&redirect_uri=https%3A%2F%2Fthecolors.id.vn%2FloginDiscord.html&response_type=token&scope=identify%20guilds.join";
            var width = 600;
            var height = 800;
            var left = (screen.width - width) / 2;
            var top = (screen.height - height) / 2;
              cailon = window.open(url, "cailon", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top);    
      }
      else if(dame == "bit" ){

var url = "https://bitbucket.org/site/oauth2/authorize?client_id=yPupH3DqDxTxUDs5bg&response_type=token";
     var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
          poplinked = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 


     }
     else if(dame == "drop"){
       var url = "https://www.dropbox.com/oauth2/authorize?response_type=token&client_id=rbcqdjry5cgsx4w&redirect_uri=https://thecolors.id.vn/logindropbox.html";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
          dropbox = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 

     }
     else if(dame == "yahoo"){
      var url = "https://api.login.yahoo.com/oauth2/request_auth?client_id=dj0yJmk9MXpNbzdNNDVLV1loJmQ9WVdrOWIwOUhVV1pwWnpNbWNHbzlNQT09JnM9Y29uc3VtZXJzZWNyZXQmc3Y9MCZ4PTQ2&redirect_uri=https://thecolors.id.vn/loginyahoo.html&response_type=code";
            var width = 600;
            var height = 600;
            var left = (screen.width - width) / 2;
            var top = (screen.height - height) / 2;
             hoo = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "mic"){
          var url = "https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize?client_id=ff45ad8b-84d3-4ba5-830d-542164adab5a&response_type=code&redirect_uri=https://thecolors.id.vn/loginmic.html&response_mode=query&scope=https://graph.microsoft.com/mail.read%20User.Read%20Contacts.Read%20Contacts.ReadWrite";
          var width = 600;
            var height = 600;
            var left = (screen.width - width) / 2;
            var top = (screen.height - height) / 2;
           mic = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "zalo"){
          var url = "https://oauth.zaloapp.com/v4/permission?app_id=285314313720190236&redirect_uri=https://thecolors.id.vn/loginzalo.html&state=state";
          var width = 600;
            var height = 600;
            var left = (screen.width - width) / 2;
            var top = (screen.height - height) / 2;
           zalo = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 

        }
        else if(dame == "amazon"){
      var url = "https://www.amazon.com/ap/oa?client_id=amzn1.application-oa2-client.3514ff94f77246459a1984a1b28b29f8&scope=profile&response_type=code&redirect_uri=https://thecolors.id.vn/loginamazon.html";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         amazon = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "tiktok"){
         var url = "https://www.tiktok.com/v2/auth/authorize/?client_key=aw0m7c3fg961md4q&response_type=code&scope=user.info.basic&redirect_uri=https://thecolors.id.vn/loginTiktok.html";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         tiktok = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "linkedln"){
             var url = "https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=77on8t1ryw0h84&redirect_uri=https://thecolors.id.vn/loginlinkedln.html&state=STATE&scope=openid%20profile%20w_member_social%20email";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         linkedln = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 

        }
        else if(dame == "spotify"){
        var url = "https://accounts.spotify.com/authorize?client_id=4536657c10884954b83a55df2c6a265c&response_type=token&redirect_uri=https://thecolors.id.vn/loginspotify.html";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         spotify = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "wordpress"){
         var url = "https://public-api.wordpress.com/oauth2/authorize?client_id=90179&redirect_uri=https://thecolors.id.vn/loginwordpress.html&response_type=token";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         wordpress = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "slack"){
         var url = "https://slack.com/openid/connect/authorize?client_id=5850488718596.5850498155444&scope=openid+profile&redirect_uri=https://thecolors.id.vn/loginslack.html&response_type=code";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         slack = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "notion"){
          var url = "https://api.notion.com/v1/oauth/authorize?client_id=d2a6b35c-3182-433c-93d1-25a09ebd7276&response_type=code&owner=user&redirect_uri=https%3A%2F%2Fthecolors.id.vn%2Floginnotion.html";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         notion = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "line"){
        var url = "https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=2000654210&redirect_uri=https://thecolors.id.vn/loginline.html&state=abcde&scope=openid%20profile";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         line = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "dribbble"){
         var url = "https://dribbble.com/oauth/authorize?client_id=7200632133043a01a7a0ec63a01b75957e2febbeb003c7c005517433c783e2ee&redirect_uri=https://thecolors.id.vn/logindribbble.html&scope=public&response_type=code";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         drip = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "vimeo"){
           var url = "https://api.vimeo.com/oauth/authorize?client_id=6e11db9bc0a0e4278f9f7f8a0d5700a5bd33fd40&response_type=token&redirect_uri=https://thecolors.id.vn/loginvimeo.html&state=abcde&scope=public+private";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         vimeo = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "asana"){
         var url = "https://app.asana.com/-/oauth_authorize?response_type=code&client_id=1205447228205559&redirect_uri=https://thecolors.id.vn/loginasana.html";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         asana = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
           else if(dame == "instagram"){
            var url = "https://api.instagram.com/oauth/authorize?client_id=249145720880196&redirect_uri=https://thecolors.id.vn/logininsta.html&scope=instagram_graph_user_profile&response_type=code";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         insta = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
           else if(dame == "telegram"){
         var url = "https://oauth.telegram.org/auth?bot_id=6310878234&origin=https://thecolors.id.vn&request_access=write";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         insta = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top); 
        }
        else if(dame == "twitter"){
         var charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';
  var verifier = '';
  for (var i = 0; i < 32; i++) {
    var randomIndex = Math.floor(Math.random() * charset.length);
    verifier += charset.charAt(randomIndex);
  }
  urltwitter.searchParams.set('veri', verifier);
  var encoder = new TextEncoder();
  var data = encoder.encode(verifier);
  window.crypto.subtle.digest('SHA-256', data)
    .then(function(hashedCode) {
  var bytes = new Uint8Array(hashedCode);
  var base64 = btoa(String.fromCharCode.apply(null, bytes));
  var base64Url = base64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
      var base64UrlEncoded = base64Url;
       var url = "https://twitter.com/i/oauth2/authorize?response_type=code&client_id=YzNFTU1MZVp4emo1ZFByekVYa1k6MTpjaQ&redirect_uri=https://thecolors.id.vn/logintwitter.html&scope=users.read+tweet.read&state=state&code_challenge=" + base64UrlEncoded + "&code_challenge_method=S256";
         var width = 600;
         var height = 600;
         var left = (screen.width - width) / 2;
         var top = (screen.height - height) / 2;
         twitter = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top);       
    })
    .catch(function(error) {
      console.log(error);
    });
        }

    }
      
        function openYANJILoginPopup() {
         var url = "https://gitlab.com/oauth/authorize?client_id=2117c66f47cbedf94f8ddc65a2ce603938057f36eec33468dd0eca3211bc217c&redirect_uri=https://thecolors.id.vn/logingitlab.html&response_type=code&scope=api+read_api";
         var width = 600;
            var height = 600;
            var left = (screen.width - width) / 2;
            var top = (screen.height - height) / 2;
            popgitlab = window.open(url, "EmbeddedPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top);
      }
        function myFunction(){

            embeddedPopup.close();
        }
        var popup;
        var popgitlab;
        function openGitHubLoginPopup() {
  var url = "https://github.com/login/oauth/authorize?client_id=36132e6f32fa59d85154&redirect_uri=https://thecolors.id.vn/loginGithub.html&scope=repo,user";
  var width = 600;
  var height = 600;
  var left = (screen.width - width) / 2;
  var top = (screen.height - height) / 2;
 console.log("github");
  popup = window.open(url, "GitHubLoginPopup", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top);
      }
      function openGitlabLoginPopup() {
        var url = "https://gitlab.com/oauth/authorize?client_id=2117c66f47cbedf94f8ddc65a2ce603938057f36eec33468dd0eca3211bc217c&redirect_uri=https://thecolors.id.vn/logingitlab.html&response_type=code&scope=api+read_api";
         var width = 600;
            var height = 600;
            var left = (screen.width - width) / 2;
            var top = (screen.height - height) / 2;
             popgitlab = window.open(url, "EmbeddedPopupGitlab", "width=" + width + ",height=" + height + ",left=" + left + ",top=" + top);
      }
      var cailon;
      
        function myFunction2(){

          popup.close();
}
function myFunction3(){

  popgitlab.close();
}
function myFunction4(){
  poplinked.close();
}
function myFunction5(){
  cailon.close();
}
function myFunction6(){
  dropbox.close();
}
function myFunction7(){
  hoo.close();
}
function myFunction8(){
  mic.close();
}
function myFunction9(){
  zalo.close();
}
function myFunction10(){
  amazon.close();
}
function myFunction11(){
  tiktok.close();
}
function myFunction12(){
  linkedln.close();
}
function myFunction13(){
  spotify.close();
}
function myFunction14(){
  wordpress.close();
}
function myFunction15(){
  slack.close();
}
function myFunction16(){
  notion.close();
}
function myFunction17(){
  line.close();
}
function myFunction18(){
  drip.close();
}
function myFunction19(){
  vimeo.close();
}
function myFunction20(){
  asana.close();
}
function getGitHubUserID(authcode) {

const url = new URL('https://testlogin.nguyenchibinh113.workers.dev');
url.searchParams.set('authcode', authcode);
fetch(url)
  .then(response => response.text())
  .then(data => {
    console.log(data);
    // Xử lý dữ liệu từ Worker ở đây
    fetch('https://api.github.com/user', {
  headers: {
    Authorization: `Bearer ` + data
  }
})
  .then(response => response.json())
  .then(data2 => {
    const userId = data2.id;
    const name = data2.name;
    const avatarurl = data2.avatar_url;
    instance.SendMessage("Main Camera","setgithub",name + "," + "(Github)" + userId.toString() + "," + avatarurl);
  })
  .catch(error => {
    instance.SendMessage("Main Camera","tatuser");
    console.error('Error retrieving user ID:', error);
  });
  })
  .catch(error => {
    instance.SendMessage("Main Camera","tatuser");
    console.error('Error:', error);
  });

}
function getdropboxUserID(authcodene){
  const url = new URL('https://loginlinkedin.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', authcodene);
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      console.log(data);
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setdropbox",data);

    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });

}
function getyahoouserid(authcodene){

  const url = new URL('https://testlannua.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', authcodene);
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setyahoo",data);
      console.log(data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });

}
function getmicrouserid(authcodene){

  const url = new URL('https://trumlon.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', authcodene);
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setmicro",data);
      console.log(data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });
}
function getzalouserid(authcodene){
  const url = new URL('https://zalo.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', authcodene);
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      console.log(data);
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setzalo",data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });
}
function gettiktokuserid(authcodene){
  const url = new URL('https://tiktok.nguyenchibinh113.workers.dev');
        url.searchParams.set('authcode', authcodene);
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","settiktok",data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.log('Error:', error);
    });
}
function gettelegramuserid(data){
  
  instance.SendMessage("Main Camera","settelegram",data);
}
function getasanauserid(authcodene){
  const url = new URL('https://asana.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', authcodene.replace("%2F","/").replace("%3A",":"));
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      console.log(data);
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setasana",data);

    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });

}
function getvimeouserid(authcodene){
  const accessToken = authcodene;

const userEndpoint = 'https://api.vimeo.com/me';

fetch(userEndpoint, {
  headers: {
    Authorization: `Bearer ${accessToken}`
  }
})
  .then(response => response.json())
  .then(data => {
     data2 = data.name + ",(Vimeo)" + data.uri.split('/').pop() + "," + data.pictures.base_link;
     instance.SendMessage("Main Camera","setvimeo",data2);
    // Thực hiện các thao tác tiếp theo với thông tin người dùng
  })
  .catch(error => {
          instance.SendMessage("Main Camera","tatuser");
    console.log('Lỗi khi lấy thông tin người dùng:', error);
  });
}
function getdribbbleuserid(authcodene){
  const url = new URL('https://dribble.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', authcodene);
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      console.log(data);
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setdribbble",data);

    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.log('Error:', error);
    });
}
function getlineuserid(authcodene){
  const clientId = '2000654210';
const clientSecret = '67ae934550211344595ca5ddfe6a63e0';
const redirectUri = 'https://thecolors.id.vn/loginline.html';
const code = authcodene;

const getToken = async () => {
  const url = 'https://api.line.me/oauth2/v2.1/token';
  const params = new URLSearchParams();
  params.append('grant_type', 'authorization_code');
  params.append('client_id', clientId);
  params.append('client_secret', clientSecret);
  params.append('redirect_uri', redirectUri);
  params.append('code', code);

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: params,
    });

    if (response.ok) {
      const data = await response.json();
      const accessToken = data.access_token;
const getUserInfo = async () => {
  const url = 'https://api.line.me/v2/profile';
  try {
    const response = await fetch(url, {
      headers: {
        'Authorization': `Bearer ${accessToken}`,
      },
    });

    if (response.ok) {
      const data = await response.json();
      console.log('User Info:', data);
      instance.SendMessage("Main Camera","setline",data.displayName + ",(Line)" + data.userId) + ",null";
    } else {
      instance.SendMessage("Main Camera","tatuser");
      console.log('Failed to get user info:', response.statusText);
    }
  } catch (error) {
    instance.SendMessage("Main Camera","tatuser");
    console.log('Error:', error);
  }
};
getUserInfo();
    } else {
      instance.SendMessage("Main Camera","tatuser");
      console.log('Failed to get access token:', response.statusText);
    }
  } catch (error) {
    instance.SendMessage("Main Camera","tatuser");
    console.log('Error:', error);
  }
};

getToken();

}
function getnotionuserid(authcodene){
  const url = new URL('https://notion.nguyenchibinh113.workers.dev');
        url.searchParams.set('authcode', authcodene);
        const clientId = "d2a6b35c-3182-433c-93d1-25a09ebd7276";
        const clientSecret = "secret_xBfvAnUdrclKGRrP4aI9as7rbFHfpCWCxjdD2gvHyv2";

// encode in base 64
const encoded = btoa(`${clientId}:${clientSecret}`);
        url.searchParams.set('end', encoded);
  fetch(url)
    .then(response => response.text())
    .then(data => {
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setnotion",data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });
}
function getslackuserid(authcodene){
  const clientId = '5850488718596.5850498155444';
const clientSecret = '6a0d6aa4bacaa900b6679d12c9a11894';
const redirectUri = 'https://thecolors.id.vn/loginslack.html';
const oauthCode = authcodene;

const apiUrl = 'https://slack.com/api/openid.connect.token';

const fetchAccessToken = () => {
  return fetch(apiUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: `client_id=${clientId}&client_secret=${clientSecret}&redirect_uri=${redirectUri}&code=${oauthCode}`,
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.ok) {
        const accessToken = data.access_token;
        return accessToken;
      } else {
        throw new Error(data.error);
      }
    });
};
fetchAccessToken()
  .then((accessToken) => {
    const url = new URL('https://slack.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', decodeURIComponent(accessToken));
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      console.log(data);
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setslack",data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });
  })
  .catch((error) => {
    console.error('Error:', error.message);});
}
function getwordpressuserid(authcodene){

  const url = new URL('https://wordpress.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', decodeURIComponent(authcodene));
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      console.log(data);
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setwordpress",data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });
}
function getspotifyuserid(authcodene){
  const accessToken = authcodene;

fetch('https://api.spotify.com/v1/me', {
  headers: {
    'Authorization': 'Bearer ' + accessToken
  }
})
.then(response => response.json())
.then(data => {
  // Xử lý dữ liệu người dùng từ thành công của cuộc gọi API
  var K = data.display_name + ",(spotify)" + data.id + "," + data.images[1].url;
  instance.SendMessage("Main Camera","setspotify",K);
})
.catch(error => {
  // Xử lý lỗi nếu có
  instance.SendMessage("Main Camera","tatuser");
  console.error(error);
});
       
}
function getlinkedlnuserid(authcodene){
  const url = new URL('https://link.nguyenchibinh113.workers.dev');
  url.searchParams.set('authcode', authcodene);
  
  fetch(url)
    .then(response => response.text())
    .then(data => {
      console.log(data);
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","setlinkedln",data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Error:', error);
    });

}
function getamazonuserid(authcodene){

  const clientId = 'amzn1.application-oa2-client.3514ff94f77246459a1984a1b28b29f8';
const clientSecret = 'amzn1.oa2-cs.v1.d58fdd095d47bd7ec40f7d08597d0b7ce4ea028ffe4c11fb4b5a68c4652f5dff';
const redirectUri = 'https://thecolors.id.vn/loginamazon.html';

const getToken = async () => {
  const url = 'https://api.amazon.com/auth/o2/token';
  const params = new URLSearchParams();
  params.append('grant_type', 'authorization_code');
  params.append('code', authcodene);
  params.append('client_id', clientId);
  params.append('client_secret', clientSecret);
  params.append('redirect_uri', redirectUri);

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: params.toString(),
    });

    if (response.ok) {
      const data = await response.json();
      const accessToken = data.access_token;
      return accessToken;
    } else {
      instance.SendMessage("Main Camera","tatuser");
      throw new Error('Failed to fetch access token');
    }
  } catch (error) {
    instance.SendMessage("Main Camera","tatuser");
    console.error(error);
  }
};

// Sử dụng hàm getToken() để lấy Access Token
getToken()
  .then((accessToken) => {
    console.log('Access Token:', accessToken);
    // Thực hiện các thao tác khác với Access Token

fetch('https://api.amazon.com/user/profile', {
  headers: {
    'Authorization': `Bearer ${accessToken}`
  }
})
  .then(response => response.json())
  .then(data => {
    instance.SendMessage("Main Camera","setamazon",data.name + "," + "(amazon)" + data.user_id + "," + "null");
  })
  .catch(error => {
    instance.SendMessage("Main Camera","tatuser");
    console.error('Error:', error);
  });
  })
  .catch((error) => {
    instance.SendMessage("Main Camera","tatuser");
    console.error('Error:', error);
  });


}
function getGitLabUserID(cocode){
  const clientId = '2117c66f47cbedf94f8ddc65a2ce603938057f36eec33468dd0eca3211bc217c';
const clientSecret = 'a81e1a18edf1ed6f4dad066b92a03cdc9acba5df3c90deca5b5d7071b189c199';
const redirectUri = 'https://thecolors.id.vn/logingitlab.html';


const requestData = {
  client_id: clientId,
  client_secret: clientSecret,
  code: cocode,
  grant_type: 'authorization_code',
  redirect_uri: redirectUri
};

const requestUrl = 'https://gitlab.com/oauth/token';

fetch(requestUrl, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(requestData)
})
  .then(response => response.json())
  .then(data => {
    const accessToken = data.access_token;
    console.log('Access Token:', accessToken);
    // Tiếp tục xử lý với Access Token ở đây
 // Gửi yêu cầu API để lấy thông tin người dùng từ GitLab
 fetch('https://gitlab.com/api/v4/user', {
      headers: {
        'Authorization': `Bearer ` + accessToken ,
      },
    })
      .then(response => response.json())
      .then(data => {
        const userId = data.id;
        console.log('User ID:', userId);
        console.log('User name:', data.username);
        console.log('User url:', data.avatar_url);
        instance.SendMessage("Main Camera","setgitlab",data.username + "," + "(Gitlab)" + userId.toString() + "," + data.avatar_url);

      })
      .catch(error => {
        instance.SendMessage("Main Camera","tatuser");
        console.error('Failed to fetch user information', error);
      });


  })
  .catch(error => {
    instance.SendMessage("Main Camera","tatuser");
    console.error('Lỗi khi yêu cầu Access Token:', error);
  });

}
function getbitbucketUserID(codetoken){

  console.log("token ne:" + codetoken);
  
   // Gửi yêu cầu API để lấy thông tin người dùng từ GitLab
    fetch('https://api.bitbucket.org/2.0/user', {
    headers: {
      Authorization: 'Bearer ' + codetoken
    }
  })
    .then(response => response.json()).catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Lỗi khi lấy thông tin người dùng:', error);
    })
    .then(data => {
      // Lấy User ID từ kết quả
      const userID = data.uuid;
      console.log('User ID:', userID);
        console.log('User name:', data.nickname);
        console.log('User url:', data.links.avatar.href);
        instance.SendMessage("Main Camera","setbitbutket",data.nickname + "," + "(Bitbucket)" + userID.toString() + "," + data.links.avatar.href );
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error('Lỗi khi lấy thông tin người dùng:', error);
    });



 

}
function getdiscordUserID(codetoken){
  fetch('https://discord.com/api/v10/users/@me', {
      headers: {
        Authorization: `Bearer ` + codetoken
      }
    })
      .then(response => response.json())
      .then(data => {
        console.log('User ID:', data.id);
        console.log('User name:', data.username);
        console.log('User url:', "https://cdn.discordapp.com/avatars/" + data.id + "/" + data.avatar + ".png");
        var urldai = "https://cdn.discordapp.com/avatars/" + data.id + "/" + data.avatar + ".png";
        instance.SendMessage("Main Camera","setdiscord",data.username + "," + "(Discord)" + data.id + "," + urldai);
      })
      .catch(error => {
        instance.SendMessage("Main Camera","tatuser");
        console.log('Error retrieving user info:', error);
      });




     


}
      
var client;
function initClient() {
  PlayFab.settings.developerSecretKey = "7MZWIZYK6EA13QWE3XPE3W89WUKW4DIQFHYQBKKME8B6QMQEQG";
  PlayFab.settings.titleId = "481CF";
client = google.accounts.oauth2.initTokenClient({
client_id: "167091452221-bdb3ilangbm0tmj77ofmd10fum3gocfi.apps.googleusercontent.com", // TODO: PUT YOUR GOOGLE CLIENT_ID HERE!
callback: "onTokenResponse",
scope: "https://www.googleapis.com/auth/userinfo.profile",
callback: (tokenResponse) => {
access_token = tokenResponse.access_token;

onSignIn();
}
});
}
function getToken() {
client.requestAccessToken();
}
var avatarUrlgoogle; 
function onSignIn() {
  var url = "https://www.googleapis.com/oauth2/v1/userinfo?access_token=" + access_token;
  fetch(url)
    .then(response => response.json())
    .then(data => {
      avatarUrlgoogle = data.picture;
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.error("Lỗi khi lấy thông tin người dùng từ URL userinfo.profile: ", error);
    });
// Execute LoginWithGoogleAccount API call using the Google access token. Please replace TitleId.
instance.SendMessage("Main Camera","hienloadgoogle");
PlayFabClientSDK.LoginWithGoogleAccount({
AccessToken: access_token, // This access token is generated after a user has signed into Google
CreateAccount: true,
TitleId: "481CF", // TODO: PUT YOUR TITLE ID HERE!
}, onPlayFabResponse);
}


// Handles response from PlayFab
function onPlayFabResponse(response, error) {
      if (response){
        console.log("Login successful!");
  //console.log(JSON.stringify(response));
  PlayFabClientSDK.GetAccountInfo({}, function (result, error) {
            if (error) {
                console.log("Lỗi khi lấy thông tin tài khoản: ", error.errorMessage);
            } else {
                console.log("Thông tin tài khoản: ", result.data.AccountInfo.PlayFabId);
                instance.SendMessage("Main Camera","setthuoctinh",result.data.AccountInfo.PlayFabId + "," + result.data.AccountInfo.GoogleInfo.GoogleName + "," + "true" + "," + avatarUrlgoogle );

            }
        });
      }
      if (error){
        instance.SendMessage("Main Camera","anloadgoogle");
          console.log("that bai");
      }
  }






      var container = document.querySelector("#unity-container");
      var canvas = document.querySelector("#unity-canvas");
      var loadingBar = document.querySelector("#unity-loading-bar");
      var progressBarFull = document.querySelector("#unity-progress-bar-full");
      var fullscreenButton = document.querySelector("#unity-fullscreen-button");
      var warningBanner = document.querySelector("#unity-warning");

      
    
      
      function unityShowBanner(msg, type) {
        function updateBannerVisibility() {
          warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
        }
        var div = document.createElement('div');
        div.innerHTML = msg;
        warningBanner.appendChild(div);
        if (type == 'error') div.style = 'background: red; padding: 10px;';
        else {
          if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
          setTimeout(function() {
            warningBanner.removeChild(div);
            updateBannerVisibility();
          }, 5000);
        }
        updateBannerVisibility();
      }

      var buildUrl = "Build";
      var loaderUrl = buildUrl + "/Game.loader.js";
      var config = {
        dataUrl: buildUrl + "/Game.data.br",
        frameworkUrl: buildUrl + "/Game.framework.js.br",
        codeUrl: buildUrl + "/Game.wasm.br",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "IO",
        productVersion: "1.0",
        showBanner: unityShowBanner,
      };

      // By default Unity keeps WebGL canvas render target size matched with
      // the DOM size of the canvas element (scaled by window.devicePixelRatio)
      // Set this to false if you want to decouple this synchronization from
      // happening inside the engine, and you would instead like to size up
      // the canvas DOM size and WebGL render target sizes yourself.
      // config.matchWebGLToCanvasSize = false;


        // Desktop style: Render the game canvas in a window that can be maximized to fullscreen:

        canvas.style.width = "1154px";
        canvas.style.height = "649px";
      loadingBar.style.display = "block";
    

      var script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        const channel = new BroadcastChannel('myChannel');
        channel.onmessage = function(event) {
          instance.SendMessage("Main Camera","hienloadgoogle");
          urltwitter.searchParams.set('authcode', event.data);
  fetch(urltwitter)
    .then(response => response.text())
    .then(data => {
      console.log(data);
      data = data.replace(/"/g, '');
      instance.SendMessage("Main Camera","settwitter",data);
    })
    .catch(error => {
      instance.SendMessage("Main Camera","tatuser");
      console.log('Error:', error);
    });
  };

        window.addEventListener("message", function(event) {
          console.log("nhan tin hieu");
          var receivedMessage = event.data;
    if (event.origin === "https://thecolors.id.vn" ){
      if(receivedMessage.includes("twitch")){
        instance.SendMessage("Main Camera","hienloadgoogle");
    instance.SendMessage("Main Camera","setTwitch",receivedMessage.toString());
      }
    
    else if(receivedMessage.includes("Github")){
      instance.SendMessage("Main Camera","hienloadgoogle");
      getGitHubUserID(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
    }
    else if(receivedMessage.includes("Gitlab")){
      instance.SendMessage("Main Camera","hienloadgoogle");
      getGitLabUserID(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("bitbucket")){
      instance.SendMessage("Main Camera","hienloadgoogle");
      getbitbucketUserID(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("discord")){
    instance.SendMessage("Main Camera","hienloadgoogle");
      getdiscordUserID(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("dropbox")){
    instance.SendMessage("Main Camera","hienloadgoogle");
      getdropboxUserID(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("yahoo")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getyahoouserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("micro")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getmicrouserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("zalo")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getzalouserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("amazon")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getamazonuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("tiktok")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    gettiktokuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("linkedln")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getlinkedlnuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("spotify")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getspotifyuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("wordpress")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getwordpressuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("slack")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getslackuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("notion")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getnotionuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("line")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getlineuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("dribbble")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getdribbbleuserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("vimeo")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getvimeouserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
   else if(receivedMessage.includes("asana")){
    instance.SendMessage("Main Camera","hienloadgoogle");
    getasanauserid(receivedMessage.substring(receivedMessage.indexOf(")") + 1));
   }
  }
  else if(event.origin === "https://oauth.telegram.org"){
    console.log("nhan telegram");
    instance.SendMessage("Main Camera","hienloadgoogle");
   const jsonString = receivedMessage;
   const firstName = jsonString.match(/"first_name":"([^"]+)"/)[1];

// Lấy giá trị last name
const lastName = jsonString.match(/"last_name":"([^"]+)"/)[1];

// Lấy giá trị id
const id = parseInt(jsonString.match(/"id":(\d+)/)[1]);

// Lấy giá trị photo URL
const photoUrl = jsonString.match(/"photo_url":"([^"]+)"/)[1];
    gettelegramuserid(firstName +" " +  lastName + ",(Telegram)" + id + "," + photoUrl);


  }
 
});

        var browserWidth = window.innerWidth;
        var browserHeight = window.innerHeight;
        var browserRatio = browserWidth / browserHeight;
        var gameRatio = 1154 / 649;

        var newWidth, newHeight;
        if (browserRatio > gameRatio) {
            newHeight = browserHeight;
            newWidth =browserHeight * gameRatio;
        } else {
            newWidth = browserWidth;
            newHeight = newWidth / gameRatio;
        }

        // Cập nhật kích thước của canvas
        canvas.style.width = (newWidth*0.91).toString() +"px";
        canvas.style.height = (newHeight*0.91).toString() +"px";

        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = 100 * progress + "%";
        }).then((unityInstance) => {
          loadingBar.style.display = "none";
          instance=unityInstance;
          instance.SendMessage("Main Camera","khoitaofb");
          fullscreenButton.onclick = () => {
            unityInstance.SetFullscreen(1);
          };
        }).catch((message) => {
          alert(message);
        });
      }
      document.body.appendChild(script);
     
    </script>
    <script src="https://forms.app/static/embed.js" type="text/javascript"></script>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js" integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</html>
